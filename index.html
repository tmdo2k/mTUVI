<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="vi">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>mAnsao</title>
<meta name="language" content="Vietnam">
<meta http-equiv="content-language" content="vi">
 <style>
      body {
        margin: 0px;
        padding: 0px;
      }
      #canvasImg {
        display: block;
        margin-left: auto;
        margin-right: auto;
      }
    </style>
  </head>
  <body>
    <form name="mTUVIform" id="mTUVIform" method="post" action="">
    <p>
     &nbsp;Tên:
		<label for="ID_TEN"></label>
		<input type="text" name="ID_TEN" id="ID_TEN";>
     &nbsp;Nam/Nữ:
        <label for="ID_GIOITINH"></label>
        <select name="ID_GIOITINH" id="ID_GIOITINH">
          <option value="1" selected>Nam</option>
          <option value="0">Nữ</option>
        </select>
    </p>
    
    <fieldset id = 'ID_DL'>
        <legend>Dương lịch</legend>
          Ngày:
          <label for="ID_SELNGAYDUONG"></label>
          <select name="ID_SELNGAYDUONG" size="1" id="ID_SELNGAYDUONG">
            <option value='1'>1</option>
            <option value='2'>2</option>
            <option value='3'>3</option>
            <option value='4' selected>4</option>
            <option value='5'>5</option>
            <option value='6'>6</option>
            <option value='7'>7</option>
            <option value='8'>8</option>
            <option value='9'>9</option>
            <option value='10'>10</option>
            <option value='11'>11</option>
            <option value='12'>12</option>
            <option value='13'>13</option>
            <option value='14'>14</option>
            <option value='15'>15</option>
            <option value='16'>16</option>
            <option value='17'>17</option>
            <option value='18'>18</option>
            <option value='19'>19</option>
            <option value='20'>20</option>
            <option value='21'>21</option>
            <option value='22'>22</option>
            <option value='23'>23</option>
            <option value='24'>24</option>
            <option value='25'>25</option>
            <option value='26'>26</option>
            <option value='27'>27</option>
            <option value='28'>28</option>
            <option value='29'>29</option>
            <option value='30'>30</option>
            <option value='31'>31</option>
          </select>
          Tháng:
          <label for="ID_SELTHANGDUONG"></label>
          <select name="ID_SELTHANGDUONG" size="1" id="ID_SELTHANGDUONG" onchange="ChangeNgay()">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6" selected>6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
          </select>
          Năm:
          <label for="ID_SELNAMDUONG3"></label>
          <select name="ID_SELNAMDUONG" id="ID_SELNAMDUONG" onchange="ChangeNgay()">
            <option value="2040">2040</option>
			<option value="2039">2039</option>
			<option value="2038">2038</option>
			<option value="2037">2037</option>
			<option value="2036">2036</option>
			<option value="2035">2035</option>
			<option value="2034">2034</option>
			<option value="2033">2033</option>
			<option value="2032">2032</option>
			<option value="2031">2031</option>
			<option value="2030">2030</option>
			<option value="2029">2029</option>
			<option value="2028">2028</option>
            <option value="2027">2027</option>
            <option value="2026">2026</option>
            <option value="2025">2025</option>
            <option value="2024">2024</option>
            <option value="2023">2023</option>
            <option value="2022">2022</option>
            <option value="2021">2021</option>
            
			<option value="2020">2020</option>
            <option value="2019">2019</option>
            <option value="2018">2018</option>
            <option value="2017">2017</option>
            <option value="2016">2016</option>
            <option value="2015">2015</option>
            <option value="2014">2014</option>
            <option value="2013">2013</option>
            <option value="2012">2012</option>
            <option value="2011">2011</option>
            <option value="2010">2010</option>
            <option value="2009">2009</option>
            <option value="2008">2008</option>
            <option value="2007">2007</option>
            <option value="2006">2006</option>
            <option value="2005">2005</option>
            <option value="2004">2004</option>
            <option value="2003">2003</option>
            <option value="2002">2002</option>
            <option value="2001">2001</option>
            
			<option value="2000">2000</option>
            <option value="1999">1999</option>
            <option value="1998">1998</option>
            <option value="1997">1997</option>
            <option value="1996">1996</option>
            <option value="1995">1995</option>
            <option value="1994">1994</option>
            <option value="1993">1993</option>
            <option value="1992">1992</option>
            <option value="1991">1991</option>
            <option value="1990">1990</option>
            <option value="1989">1989</option>
            <option value="1988">1988</option>
            <option value="1987">1987</option>
            <option value="1986">1986</option>
            <option value="1985">1985</option>
            <option value="1984">1984</option>
            <option value="1983">1983</option>
            <option value="1982">1982</option>
            <option value="1981">1981</option>
            
			<option value="1980">1980</option>
            <option value="1979">1979</option>
            <option value="1978">1978</option>
            <option value="1977">1977</option>
            <option value="1976">1976</option>
            <option value="1975">1975</option>
            <option value="1974">1974</option>
            <option value="1973">1973</option>
            <option value="1972">1972</option>
            <option value="1971">1971</option>
            <option value="1970">1970</option>
            <option value="1969">1969</option>
            <option value="1968">1968</option>
            <option value="1967">1967</option>
            <option value="1966">1966</option>
            <option value="1965">1965</option>
            <option value="1964">1964</option>
            <option value="1963" selected>1963</option>
            <option value="1962">1962</option>
            <option value="1961">1961</option>
            
			<option value="1960">1960</option>
            <option value="1959">1959</option>
            <option value="1958">1958</option>
            <option value="1957">1957</option>
            <option value="1956">1956</option>
            <option value="1955">1955</option>
            <option value="1954">1954</option>
            <option value="1953">1953</option>
            <option value="1952">1952</option>
            <option value="1951">1951</option>
            <option value="1950">1950</option>
            <option value="1949">1949</option>
            <option value="1948">1948</option>
            <option value="1947">1947</option>
            <option value="1946">1946</option>
            <option value="1945">1945</option>
            <option value="1944">1944</option>
            <option value="1943">1943</option>
            <option value="1942">1942</option>
            <option value="1941">1941</option>
            
			<option value="1940">1940</option>
            <option value="1939">1939</option>
            <option value="1938">1938</option>
            <option value="1937">1937</option>
            <option value="1936">1936</option>
            <option value="1935">1935</option>
            <option value="1934">1934</option>
            <option value="1933">1933</option>
            <option value="1932">1932</option>
            <option value="1931">1931</option>
            <option value="1930">1930</option>
            <option value="1929">1929</option>
            <option value="1928">1928</option>
            <option value="1927">1927</option>
            <option value="1926">1926</option>
            <option value="1925">1925</option>
            <option value="1924">1924</option>
            <option value="1923">1923</option>
            <option value="1922">1922</option>
            <option value="1921">1921</option>
            
			<option value="1920">1920</option>
            <option value="1919">1919</option>
            <option value="1918">1918</option>
            <option value="1917">1917</option>
            <option value="1916">1916</option>
            <option value="1915">1915</option>
            <option value="1914">1914</option>
            <option value="1913">1913</option>
            <option value="1912">1912</option>
            <option value="1911">1911</option>
            <option value="1910">1910</option>
            <option value="1909">1909</option>
            <option value="1908">1908</option>
            <option value="1907">1907</option>
            <option value="1906">1906</option>
            <option value="1905">1905</option>
            <option value="1904">1904</option>
            <option value="1903">1903</option>
            <option value="1902">1902</option>
            <option value="1901">1901</option>
            <option value="1900">1900</option>
        </select>
         Giờ:
      <label for="ID_SELGIODUONG"></label>
      <select name="ID_SELGIODUONG" id="ID_SELGIODUONG">
      	  <option value="1"> Tý 11:00pm hôm trước - tới 12:59am hôm sau</option>
		  <option value="2" selected> Sửu 1:00-2:59am</option>
		  <option value="3"> Dần 3:00-4:59am</option>
		  <option value="4"> Mão 5:00am-6:59am</option>
		  <option value="5"> Thìn 7:00-8:59am</option>
		  <option value="6"> Tỵ 9:00-10:59am</option>
		  <option value="7"> Ngọ 11:00-12:59pm</option>
		  <option value="8"> Mùi 1:00-2:59pm</option>
		  <option value="9"> Thân 3:00-4:59pm</option>
		  <option value="10"> Dậu 5:00-6:59pm</option>
		  <option value="11"> Tuất 7:00-8:59pm</option>
		  <option value="12"> Hợi 9:00-10:59pm</option>
      </select> <i>(nếu sinh sau 10:59pm: tăng lên 1 ngày và chọn giờ Tý)</i>
      </fieldset>
	    
      <p>&nbsp;Năm hạn:
        <label for="ID_SELNAMXEM"></label>
        <select name="ID_SELNAMXEM" id="ID_SELNAMXEM">
            <option value="2096">2096</option>
            <option value="2095">2095</option>
            <option value="2094">2094</option>
            <option value="2093">2093</option>
            <option value="2092">2092</option>
            <option value="2091">2091</option>
            <option value="2090">2090</option>
            <option value="2089">2089</option>
            <option value="2088">2088</option>
            <option value="2087">2087</option>
            <option value="2086">2086</option>
        	<option value="2085">2085</option>
            <option value="2084">2084</option>
            <option value="2083">2083</option>
            <option value="2082">2082</option>
            <option value="2081">2081</option>

            <option value="2080">2080</option>
            <option value="2079">2079</option>
            <option value="2078">2078</option>
            <option value="2077">2077</option>
            <option value="2076">2076</option>
            <option value="2075">2075</option>
            <option value="2074">2074</option>
            <option value="2073">2073</option>
            <option value="2072">2072</option>
        	<option value="2071">2071</option>
            <option value="2070">2070</option>
            <option value="2069">2069</option>
            <option value="2068">2068</option>
            <option value="2067">2067</option>
            <option value="2066">2066</option>
            <option value="2065">2065</option>
            <option value="2064">2064</option>
            <option value="2063">2063</option>
            <option value="2062">2062</option>
            <option value="2061">2061</option>

            <option value="2060">2060</option>
            <option value="2059">2059</option>
            <option value="2058">2058</option>
            <option value="2057">2057</option>
            <option value="2056">2056</option>
            <option value="2055">2055</option>
            <option value="2054">2054</option>
            <option value="2053">2053</option>
            <option value="2052">2052</option>
            <option value="2051">2051</option>
            <option value="2050">2050</option>
            <option value="2049">2049</option>
            <option value="2048">2048</option>
            <option value="2047">2047</option>
            <option value="2046">2046</option>
            <option value="2045">2045</option>
            <option value="2044">2044</option>
            <option value="2043">2043</option>
            <option value="2042">2042</option>
            <option value="2041">2041</option>
            
			<option value="2040">2040</option>
            <option value="2039">2039</option>
            <option value="2038">2038</option>
            <option value="2037">2037</option>
            <option value="2036">2036</option>
            <option value="2035">2035</option>
            <option value="2034">2034</option>
            <option value="2033">2033</option>
            <option value="2032">2032</option>
            <option value="2031">2031</option>
            <option value="2030">2030</option>
            <option value="2029">2029</option>
            <option value="2028">2028</option>
            <option value="2027">2027</option>
            <option value="2026">2026</option>
            <option value="2025" selected>2025</option>
            <option value="2024">2024</option>
            <option value="2023">2023</option>
            <option value="2022">2022</option>
            <option value="2021">2021</option>
            
			<option value="2020">2020</option>
            <option value="2019">2019</option>
            <option value="2018">2018</option>
            <option value="2017">2017</option>
            <option value="2016">2016</option>
            <option value="2015">2015</option>
            <option value="2014">2014</option>
            <option value="2013">2013</option>
            <option value="2012">2012</option>
            <option value="2011">2011</option>
            <option value="2010">2010</option>
            <option value="2009">2009</option>
            <option value="2008">2008</option>
            <option value="2007">2007</option>
            <option value="2006">2006</option>
            <option value="2005">2005</option>
            <option value="2004">2004</option>
            <option value="2003">2003</option>
            <option value="2002">2002</option>
            <option value="2001">2001</option>
            
			<option value="2000">2000</option>
            <option value="1999">1999</option>
            <option value="1998">1998</option>
            <option value="1997">1997</option>
            <option value="1996">1996</option>
            <option value="1995">1995</option>
            <option value="1994">1994</option>
            <option value="1993">1993</option>
            <option value="1992">1992</option>
            <option value="1991">1991</option>
            <option value="1990">1990</option>
            <option value="1989">1989</option>
            <option value="1988">1988</option>
            <option value="1987">1987</option>
            <option value="1986">1986</option>
            <option value="1985">1985</option>
            <option value="1984">1984</option>
            <option value="1983">1983</option>
            <option value="1982">1982</option>
            <option value="1981">1981</option>
            
			<option value="1980">1980</option>
            <option value="1979">1979</option>
            <option value="1978">1978</option>
            <option value="1977">1977</option>
            <option value="1976">1976</option>
            <option value="1975">1975</option>
            <option value="1974">1974</option>
            <option value="1973">1973</option>
            <option value="1972">1972</option>
            <option value="1971">1971</option>
            <option value="1970">1970</option>
            <option value="1969">1969</option>
            <option value="1968">1968</option>
            <option value="1967">1967</option>
            <option value="1966">1966</option>
            <option value="1965">1965</option>
            <option value="1964">1964</option>
            <option value="1963">1963</option>
            <option value="1962">1962</option>
            <option value="1961">1961</option>
            
			<option value="1960">1960</option>
            <option value="1959">1959</option>
            <option value="1958">1958</option>
            <option value="1957">1957</option>
            <option value="1956">1956</option>
            <option value="1955">1955</option>
            <option value="1954">1954</option>
            <option value="1953">1953</option>
            <option value="1952">1952</option>
            <option value="1951">1951</option>
            <option value="1950">1950</option>
            <option value="1949">1949</option>
            <option value="1948">1948</option>
            <option value="1947">1947</option>
            <option value="1946">1946</option>
            <option value="1945">1945</option>
            <option value="1944">1944</option>
            <option value="1943">1943</option>
            <option value="1942">1942</option>
            <option value="1941">1941</option>
            
			<option value="1940">1940</option>
            <option value="1939">1939</option>
            <option value="1938">1938</option>
            <option value="1937">1937</option>
            <option value="1936">1936</option>
            <option value="1935">1935</option>
            <option value="1934">1934</option>
            <option value="1933">1933</option>
            <option value="1932">1932</option>
            <option value="1931">1931</option>
            <option value="1930">1930</option>
            <option value="1929">1929</option>
            <option value="1928">1928</option>
            <option value="1927">1927</option>
            <option value="1926">1926</option>
            <option value="1925">1925</option>
            <option value="1924">1924</option>
            <option value="1923">1923</option>
            <option value="1922">1922</option>
            <option value="1921">1921</option>
            
			<option value="1920">1920</option>
            <option value="1919">1919</option>
            <option value="1918">1918</option>
            <option value="1917">1917</option>
            <option value="1916">1916</option>
            <option value="1915">1915</option>
            <option value="1914">1914</option>
            <option value="1913">1913</option>
            <option value="1912">1912</option>
            <option value="1911">1911</option>
            <option value="1910">1910</option>
            <option value="1909">1909</option>
            <option value="1908">1908</option>
            <option value="1907">1907</option>
            <option value="1906">1906</option>
            <option value="1905">1905</option>
            <option value="1904">1904</option>
            <option value="1903">1903</option>
            <option value="1902">1902</option>
            <option value="1901">1901</option>
            <option value="1900">1900</option>
        </select>
      &nbsp;Sao lưu:
		<input type="checkbox" name="ID_SAOLUU" id="ID_SAOLUU" onclick="ShowInput();">
		<label for="ID_SAOLUU"></label>
		<button type="submit" onclick="Anlaso();">An Sao</button>
</form>

<canvas id="LasoCanvas" width="760" height="810" style="display:none;"></canvas>	
<script type="text/javascript">
var canvas = document.getElementById('LasoCanvas');
var context = canvas.getContext('2d');

function ChangeListNgay(tngay)
{
	var listngay = document.getElementById('ID_SELNGAYDUONG');
	var len = listngay.options.length;
	var newngay = len;
	
	if (len < tngay)
	{
		for (i = 1; i<= (tngay - len); i++)
		{
			newngay++;
			var temp = newngay.toString();
			var optnew = document.createElement('option');
			optnew.value = temp;
			optnew.text = temp;
			try{
				listngay.add(optnew, null);
			} catch (e)
			{
				listngay.add(optnew);
			}
		}
	}
	else if (len > tngay)
	{
		for (i = 1; i<= (len - tngay); i++)
		{
			listngay.remove(listngay.length - 1);
		}
	}
}

function ChangeNgay()
{
	var listthang = document.getElementById('ID_SELTHANGDUONG');
	var listnam = document.getElementById('ID_SELNAMDUONG');

	var nam;
	var thang;
	var lennam = listnam.options.length;
	var lenthang = listthang.options.length;
	for (i = 0; i< lennam; i++)
	{
		if (listnam.options[i].selected)
			nam = parseInt(listnam.options[i].value);
	}

	for (i = 0; i< lenthang; i++)
	{
		if (listthang.options[i].selected)
			thang = parseInt(listthang.options[i].value);
	}

	var ngay;
	if (thang == 1 || thang == 3 || thang == 5 || thang == 7 || thang == 8 || thang == 10 || thang == 12)
		ngay = 31;
	else if (thang == 2)
	{
		if (nam % 4 == 0)
		{
			ngay = 29;
		}
		else ngay = 28;
	}
	else ngay = 30;
	ChangeListNgay(ngay);
}

var background = new (function()
{
}
);

/*
 * Copyright (c) 2006 Ho Ngoc Duc. All Rights Reserved.
 * Astronomical algorithms from the book "Astronomical Algorithms" by Jean Meeus, 1998
 *
 * Permission to use, copy, modify, and redistribute this software and its
 * documentation for personal, non-commercial use is hereby granted provided that
 * this copyright notice and appropriate documentation appears in all copies.
 */
var PI = Math.PI;

/* Discard the fractional part of a number, e.g., INT(3.2) = 3 */
function INT(d) {
	return Math.floor(d);
}

/* Compute the (integral) Julian day number of day dd/mm/yyyy, i.e., the number
 * of days between 1/1/4713 BC (Julian calendar) and dd/mm/yyyy.
 * Formula from http://www.tondering.dk/claus/calendar.html
 */
function jdFromDate(dd, mm, yy) {
	var a, y, m, jd;
	a = INT((14 - mm) / 12);
	y = yy+4800-a;
	m = mm+12*a-3;
	jd = dd + INT((153*m+2)/5) + 365*y + INT(y/4) - INT(y/100) + INT(y/400) - 32045;
	if (jd < 2299161) {
		jd = dd + INT((153*m+2)/5) + 365*y + INT(y/4) - 32083;
	}
	return jd;
}

/* Convert a Julian day number to day/month/year. Parameter jd is an integer */
function jdToDate(jd) {
	var a, b, c, d, e, m, day, month, year;
	if (jd > 2299160) { // After 5/10/1582, Gregorian calendar
		a = jd + 32044;
		b = INT((4*a+3)/146097);
		c = a - INT((b*146097)/4);
	} else {
		b = 0;
		c = jd + 32082;
	}
	d = INT((4*c+3)/1461);
	e = c - INT((1461*d)/4);
	m = INT((5*e+2)/153);
	day = e - INT((153*m+2)/5) + 1;
	month = m + 3 - 12*INT(m/10);
	year = b*100 + d - 4800 + INT(m/10);
	return new Array(day, month, year);
}

/* Compute the time of the k-th new moon after the new moon of 1/1/1900 13:52 UCT
 * (measured as the number of days since 1/1/4713 BC noon UCT, e.g., 2451545.125 is 1/1/2000 15:00 UTC).
 * Returns a floating number, e.g., 2415079.9758617813 for k=2 or 2414961.935157746 for k=-2
 * Algorithm from: "Astronomical Algorithms" by Jean Meeus, 1998
 */
function NewMoon(k) {
	var T, T2, T3, dr, Jd1, M, Mpr, F, C1, deltat, JdNew;
	T = k/1236.85; // Time in Julian centuries from 1900 January 0.5
	T2 = T * T;
	T3 = T2 * T;
	dr = PI/180;
	Jd1 = 2415020.75933 + 29.53058868*k + 0.0001178*T2 - 0.000000155*T3;
	Jd1 = Jd1 + 0.00033*Math.sin((166.56 + 132.87*T - 0.009173*T2)*dr); // Mean new moon
	M = 359.2242 + 29.10535608*k - 0.0000333*T2 - 0.00000347*T3; // Sun's mean anomaly
	Mpr = 306.0253 + 385.81691806*k + 0.0107306*T2 + 0.00001236*T3; // Moon's mean anomaly
	F = 21.2964 + 390.67050646*k - 0.0016528*T2 - 0.00000239*T3; // Moon's argument of latitude
	C1=(0.1734 - 0.000393*T)*Math.sin(M*dr) + 0.0021*Math.sin(2*dr*M);
	C1 = C1 - 0.4068*Math.sin(Mpr*dr) + 0.0161*Math.sin(dr*2*Mpr);
	C1 = C1 - 0.0004*Math.sin(dr*3*Mpr);
	C1 = C1 + 0.0104*Math.sin(dr*2*F) - 0.0051*Math.sin(dr*(M+Mpr));
	C1 = C1 - 0.0074*Math.sin(dr*(M-Mpr)) + 0.0004*Math.sin(dr*(2*F+M));
	C1 = C1 - 0.0004*Math.sin(dr*(2*F-M)) - 0.0006*Math.sin(dr*(2*F+Mpr));
	C1 = C1 + 0.0010*Math.sin(dr*(2*F-Mpr)) + 0.0005*Math.sin(dr*(2*Mpr+M));
	if (T < -11) {
		deltat= 0.001 + 0.000839*T + 0.0002261*T2 - 0.00000845*T3 - 0.000000081*T*T3;
	} else {
		deltat= -0.000278 + 0.000265*T + 0.000262*T2;
	};
	JdNew = Jd1 + C1 - deltat;
	return JdNew;
}

/* Compute the longitude of the sun at any time.
 * Parameter: floating number jdn, the number of days since 1/1/4713 BC noon
 * Algorithm from: "Astronomical Algorithms" by Jean Meeus, 1998
 */
function SunLongitude(jdn) {
	var T, T2, dr, M, L0, DL, L;
	T = (jdn - 2451545.0 ) / 36525; // Time in Julian centuries from 2000-01-01 12:00:00 GMT
	T2 = T*T;
	dr = PI/180; // degree to radian
	M = 357.52910 + 35999.05030*T - 0.0001559*T2 - 0.00000048*T*T2; // mean anomaly, degree
	L0 = 280.46645 + 36000.76983*T + 0.0003032*T2; // mean longitude, degree
	DL = (1.914600 - 0.004817*T - 0.000014*T2)*Math.sin(dr*M);
	DL = DL + (0.019993 - 0.000101*T)*Math.sin(dr*2*M) + 0.000290*Math.sin(dr*3*M);
	L = L0 + DL; // true longitude, degree
	L = L*dr;
	L = L - PI*2*(INT(L/(PI*2))); // Normalize to (0, 2*PI)
	return L;
}

/* Compute sun position at midnight of the day with the given Julian day number.
 * The time zone if the time difference between local time and UTC: 7.0 for UTC+7:00.
 * The function returns a number between 0 and 11.
 * From the day after March equinox and the 1st major term after March equinox, 0 is returned.
 * After that, return 1, 2, 3 ...
 */
function getSunLongitude(dayNumber, timeZone) {
	return INT(SunLongitude(dayNumber - 0.5 - timeZone/24)/PI*6);
}

/* Compute the day of the k-th new moon in the given time zone.
 * The time zone if the time difference between local time and UTC: 7.0 for UTC+7:00
 */
function getNewMoonDay(k, timeZone) {
	return INT(NewMoon(k) + 0.5 + timeZone/24);
}

/* Find the day that starts the luner month 11 of the given year for the given time zone */
function getLunarMonth11(yy, timeZone) {
	var k, off, nm, sunLong;
	//off = jdFromDate(31, 12, yy) - 2415021.076998695;
	off = jdFromDate(31, 12, yy) - 2415021;
	k = INT(off / 29.530588853);
	nm = getNewMoonDay(k, timeZone);
	sunLong = getSunLongitude(nm, timeZone); // sun longitude at local midnight
	if (sunLong >= 9) {
		nm = getNewMoonDay(k-1, timeZone);
	}
	return nm;
}

/* Find the index of the leap month after the month starting on the day a11. */
function getLeapMonthOffset(a11, timeZone) {
	var k, last, arc, i;
	k = INT((a11 - 2415021.076998695) / 29.530588853 + 0.5);
	last = 0;
	i = 1; // We start with the month following lunar month 11
	arc = getSunLongitude(getNewMoonDay(k+i, timeZone), timeZone);
	do {
		last = arc;
		i++;
		arc = getSunLongitude(getNewMoonDay(k+i, timeZone), timeZone);
	} while (arc != last && i < 14);
	return i-1;
}

/* Convert solar date dd/mm/yyyy to the corresponding lunar date */
function convertSolar2Lunar(dd, mm, yy, timeZone)
{
	var k, dayNumber, monthStart, a11, b11, lunarDay, lunarMonth, lunarYear, lunarLeap;
	dayNumber = jdFromDate(dd, mm, yy);
	k = INT((dayNumber - 2415021.076998695) / 29.530588853);
	monthStart = getNewMoonDay(k+1, timeZone);
	if (monthStart > dayNumber) {
		monthStart = getNewMoonDay(k, timeZone);
	}
	a11 = getLunarMonth11(yy, timeZone);
	b11 = a11;
	if (a11 >= monthStart) {
		lunarYear = yy;
		a11 = getLunarMonth11(yy-1, timeZone);
	} else {
		lunarYear = yy+1;
		b11 = getLunarMonth11(yy+1, timeZone);
	}
	lunarDay = dayNumber-monthStart+1;
	diff = INT((monthStart - a11)/29);
	lunarLeap = 0;
	lunarMonth = diff+11;
	if (b11 - a11 > 365) {
		leapMonthDiff = getLeapMonthOffset(a11, timeZone);
		if (diff >= leapMonthDiff) {
			lunarMonth = diff + 10;
			if (diff == leapMonthDiff) {
				lunarLeap = 1;
			}
		}
	}
	if (lunarMonth > 12) {
		lunarMonth = lunarMonth - 12;
	}
	if (lunarMonth >= 11 && diff < 4) {
		lunarYear -= 1;
	}
	return new Array(lunarDay, lunarMonth, lunarYear, lunarLeap);
}

function fix12(n)
{
	while (n > 12)
	{
		n = n - 12;
	}
	while (n <= 0)
	{
		n = n + 12;
	}
	return n;
}

function fix10(n)
{
	while (n > 10)
	{
		n = n - 10;
	}
	while (n <= 0)
	{
		n = n + 10;
	}
	return n;
}

function main()
 {
	function printw(chu, mauchu, vx, vy)
	{
		context.fillStyle = mauchu;
		context.fillText(chu, vx, vy);
	}

	var ngayduong;
	var thangduong;
	var namduong;
	var gioduong;
	
	var	ngay;
	var thang;
	var canmam;
	var chinam;
	var gio;
	var dl = new Array();
		
	var saoluu = 0;
		
	var namxem;
	for (i = 0; i< document.getElementById('ID_SELNAMXEM').length; i++)
	{
		if (document.getElementById('ID_SELNAMXEM').options[i].selected)
			namxem = parseInt(document.getElementById('ID_SELNAMXEM').options[i].value);
	}

	var ten = document.getElementById('ID_TEN').value;

	if (document.getElementById('ID_SAOLUU').checked)
	{
		saoluu = 1;		
	}
	else
	{
		saoluu = 0;
	}
	
	//Lấy giới tính (Nam: 1, Nữ: 0)
	var list = document.getElementById('ID_GIOITINH');
    for (var i = 0; i < list.options.length; ++i)
	{
         if (list.options[i].selected)
            gioitinh = parseInt(list.options[i].value);
    }

	//Lấy thông tin ngày tháng năm giờ sinh
	for (i = 0; i< document.getElementById('ID_SELNGAYDUONG').length; i++)
	{
		if (document.getElementById('ID_SELNGAYDUONG').options[i].selected)
			ngayduong = parseInt(document.getElementById('ID_SELNGAYDUONG').options[i].value);
	}
	
	for (i = 0; i< document.getElementById('ID_SELTHANGDUONG').length; i++)
	{
		if (document.getElementById('ID_SELTHANGDUONG').options[i].selected)
			thangduong = parseInt(document.getElementById('ID_SELTHANGDUONG').options[i].value);
	}
	
	for (i = 0; i< document.getElementById('ID_SELNAMDUONG').length; i++)
	{
		if (document.getElementById('ID_SELNAMDUONG').options[i].selected)
			namduong = parseInt(document.getElementById('ID_SELNAMDUONG').options[i].value);
	}
	
	for (i = 0; i< document.getElementById('ID_SELGIODUONG').length; i++)
	{
		if (document.getElementById('ID_SELGIODUONG').options[i].selected)
			gioduong = parseInt(document.getElementById('ID_SELGIODUONG').options[i].value);
	}
	
	dl = convertSolar2Lunar(ngayduong, thangduong, namduong, 7.0);

	ngay = dl[0];
	thang = dl[1];
	var candoi = dl[2] % 10;
	var chidoi = dl[2] % 12;

	candoi = (candoi + 7)
	if (candoi > 10) 
	{
		candoi = candoi - 10;
	}
	cannam = candoi;

	chidoi = chidoi + 9;
	if (chidoi > 12) 
	{
		chidoi = chidoi - 12;
	}
	chinam = chidoi;

	gio = gioduong;

	
	var can = new Array();
	var chi = new Array();

	can[1] = "Giáp";
	can[2] = "Ất";
	can[3] = "Bính";
	can[4] = "Đinh";
	can[5] = "Mậu";
	can[6] = "Kỷ";
	can[7] = "Canh";
	can[8] = "Tân";
	can[9] = "Nhâm";
	can[10] = "Quý";


	chi[1] = "Tý";
	chi[2] = "Sửu";
	chi[3] = "Dần";
	chi[4] = "Mão";
	chi[5] = "Thìn";
	chi[6] = "Tị";
	chi[7] = "Ngọ";
	chi[8] = "Mùi";
	chi[9] = "Thân";
	chi[10] = "Dậu";
	chi[11] = "Tuất";
	chi[12] = "Hợi";

	//tính can chi ngày tháng năm

	var canthang = fix10((cannam*2 + 1) % 10 + (thang - 1));
	var chithang = fix12(thang + 2);

	var a = ((14 - thangduong) - (14 - thangduong)%12) / 12
	var y = namduong+4800-a
	var m = thangduong +12*a-3

	//Lịch Gregory:

	var jd = ngayduong + ((153*m+2) - ((153*m+2) % 5))/5 + 365*y + (y - (y%4))/4 - (y - y%100)/100 + (y - (y%400))/400 - 32045;

	var canngay = fix10((jd + 9) % 10 + 1);
	var chingay = fix12((jd + 1) % 12 + 1);

	var cangio = fix10(fix10((canngay * 2) - 1) + gio - 1);
	var chigio = gio;

	//tính cung mệnh cung thân
	var cungmenh = fix12(thang - gio + 1);
	var cungthan = fix12(gio + thang - 1);


      // draw
	var h = canvas.height / 4;
	var w = canvas.width / 4;
		
	var xcung = new Array();
	var ycung = new Array();

	xcung[1] = 0;
	xcung[2] = 0;
	xcung[3] = 0;
	xcung[4] = 0;
	xcung[5] = w;
	xcung[6] = w*2;
	xcung[7] = w*3;
	xcung[8] = w*3;
	xcung[9] = w*3;
	xcung[10] = w*3;
	xcung[11] = w*2;
	xcung[12] = w;

	ycung[1] = 3*h;
	ycung[2] = 2*h;
	ycung[3] = h;
	ycung[4] = 0;
	ycung[5] = 0;
	ycung[6] = 0;
	ycung[7] = 0;
	ycung[8] = h;
	ycung[9] = h*2;
	ycung[10] = h*3;
	ycung[11] = h*3;
	ycung[12] = h*3;

	var xpoint = new Array();
	xpoint[1] = xcung[1] + w;
	xpoint[2] = xcung[1] + w;
	xpoint[3] = xcung[1] + w;
	xpoint[4] = xcung[1] + w;
	xpoint[5] = xcung[5] + w/2;
	xpoint[6] = xcung[6] + w/2;
	xpoint[7] = xcung[7];
	xpoint[8] = xcung[7];
	xpoint[9] = xcung[7];
	xpoint[10] = xcung[7];
	xpoint[11] = xcung[11] + w/2;
	xpoint[12] = xcung[12] + w/2;

	var ypoint = new Array();
	ypoint[1] = ycung[1];
	ypoint[2] = ycung[2] + h/2;
	ypoint[3] = ycung[3] + h/2;
	ypoint[4] = ycung[4] + h;
	ypoint[5] = ycung[5] + h;
	ypoint[6] = ycung[6] + h;
	ypoint[7] = ycung[7] + h;
	ypoint[8] = ycung[8] + h/2;
	ypoint[9] = ycung[9] + h/2;
	ypoint[10] = ycung[10];
	ypoint[11] = ycung[11] ;
	ypoint[12] = ycung[12] ;

	var cungdi = fix12(cungmenh + 6);
	var cungquan = fix12(cungmenh + 4);
	var cungtai = fix12(cungmenh - 4);


	context.beginPath();
	context.clearRect(0,0,w*4,h*4);


    context.beginPath();
	for (i = 0; i<4; i++)
	{
     	context.rect(w*i,0,w,h);
		context.rect(w*i + 0.5,0.5,w - 0.5,h - 1);
		if (i > 0)
		{
			context.rect(0,h*i,w,h);
			context.rect(0.5,h*i + 0.5,w - 1,h - 0.5);

			context.rect(w*i,h*3,w,h);
			context.rect(w*i + 0.5,h*3 + 0.5 ,w - 0.5,h + 0.5);

			context.rect(w*3,h*i,w,h);
			context.rect(w*3 + 0.5,h*i + 0.5,w + 0.5,h - 0.5);
		}
	}

	context.fillStyle = 'white';
    context.fill();
    context.strokeStyle = '#000000';
    context.stroke();

	context.beginPath();
	context.rect(1,1,w*4 -2,h*4 - 2);
	context.rect(2,2,w*4 -4,h*4 - 4);
	context.strokeStyle = '#000000';
    context.stroke();

	
	var x = w + w/2 - 25;
	var y = h + h/2 - 30;

	context.font = "8pt Verdana";
	context.fillStyle = 'purple';
	context.textAlign = 'center';
	context.fillText("email: tmdo2k@yahoo.com", w*2, h*3 - 44);

	context.font = 'bold 9pt Verdana';
	context.textAlign = 'center';
	context.fillStyle = '#353580';
	context.fillText(ten, w*2, y + 5);

	context.font = '9pt Verdana';
	context.textAlign = 'left';
	var amduong;
	if (cannam % 2 == 0)
		amduong = "Âm";
	else
		amduong = "Dương";
	if (gioitinh == 1)
		amduong = amduong + " Nam";
	else
		amduong = amduong + " Nữ";

	context.fillStyle = 'black';
	context.fillText("Năm:", x, y + 30);
	context.fillStyle = '#353580';
	context.fillText(namduong, x + 80, y + 30);
	context.fillText(can[cannam] + " " + chi[chinam],x + 130, y + 30);

	context.fillStyle = 'black';
	context.fillText("Ngày:", x, y + 46);
	context.fillStyle = '#353580';
	context.fillText(ngayduong +" (" + ngay+")", x + 80, y + 46);
	context.fillText(can[canngay] + " " + chi[chingay],x + 130, y + 46);

	context.fillStyle = 'black';
	context.fillText("Tháng:", x, y + 62);
	context.fillStyle = '#353580';
	var texttemp = "";
	
	context.fillText(thangduong + " ("+thang+texttemp+")", x + 80, y + 62);
	context.fillText(can[canthang] + " " + chi[chithang],x + 130, y + 62);

	context.fillStyle = 'black';
	context.fillText("Giờ:", x, y + 78);
	context.fillStyle = '#353580';
	context.fillText(can[cangio] + " " + chi[chigio],x + 130, y + 78);

	
	var cancungmenh = fix10(fix10(cannam  *2 + 1) + cungmenh - 1);
	var chicungmenh = fix12(cungmenh + 2);

	if (chicungmenh == 1 || chicungmenh == 7 || chicungmenh == 2 || chicungmenh == 8)
		a = 0;
	if (chicungmenh == 11 || chicungmenh == 12 || chicungmenh == 5 || chicungmenh == 6)
		a = 2;
	if (chicungmenh == 3 || chicungmenh == 4 || chicungmenh == 9 || chicungmenh == 10)
		a = 1;

	if (cancungmenh == 1 || cancungmenh == 2) b=1;
	if (cancungmenh == 3 || cancungmenh == 4) b=2;
	if (cancungmenh == 5 || cancungmenh == 6) b=3;
	if (cancungmenh == 7 || cancungmenh == 8) b=4;
	if (cancungmenh == 9 || cancungmenh == 10) b=5;

	var hanh = new Array();
	hanh[2] = "Thủy Nhị Cục";
	hanh[3] = "Mộc Tam Cục";
	hanh[4] = "Kim Tứ Cục";
	hanh[5] = "Thổ Ngũ Cục";
	hanh[6] = "Hỏa Lục Cục";

	var ihanh;
	var cuc;
	ihanh = a+b;
	if (a + b > 5) ihanh = a+b - 5;

	if (ihanh == 1) cuc = 4;
	if (ihanh == 2) cuc = 2;
	if (ihanh == 3) cuc = 6;
	if (ihanh == 4) cuc = 5;
	if (ihanh == 5) cuc = 3;

	context.fillStyle = 'black';
	context.fillText("Cục:", x, y + 122);
	context.fillStyle = '#353580';
	context.fillText(hanh[cuc],x + 80, y + 122);

	context.fillStyle = 'black';
	context.fillText("Âm/Dương:", x, y + 138);
	context.fillStyle = '#353580';
	context.fillText(amduong, x + 80, y + 138);

	if (namxem != 0)
	{
		var tuoi = namxem - namduong + 1;
		var canxem = namxem % 10;
		var chixem = namxem % 12;
		canxem = fix10(canxem + 7);
		chixem = fix12(chixem + 9);
		context.fillStyle = 'black';
		context.fillText("Năm Xem:", x, y + 154);
		context.fillStyle = '#353580';
		context.fillText(namxem + " (" + can[canxem] + " " + chi[chixem] + ")", x + 80, y + 154);
		context.fillStyle = 'black';
		context.fillText("Tuổi:", x, y + 170);
		context.fillStyle = '#353580';
		context.fillText(tuoi, x + 80, y + 170);
	}


	var kim = '#5A5A5A';
	var moc = '#037100';
	var thuy = 'black';
	var hoa = '#FF0000';
	var tho = '#FF7E00';


// an đại hạn
	context.font = 'bold 8pt Times New Roman';
	context.textAlign = "right";
	var daihan, daihan_next;
	var j = cungmenh;
	var step;
	if (amduong == "Dương Nam" || amduong == "Âm Nữ")
		step = 1;
	else
		step = -1;
	
	for (i=1; i<=12; i++)
	{
		daihan = cuc + (i - 1)*10;
		daihan_next = cuc + (i)*10;
		j = fix12(j);
		if (tuoi >= daihan && tuoi < daihan_next)
		{
			daihan = daihan + "*"
			var width = context.measureText(daihan).width; /// width in pixels
			context.fillStyle = 'yellow';
			context.fillRect(xcung[j] + w - 5 - width, ycung[j] + 10, width, 14);
		}
		printw(daihan, 'black', xcung[j] + w - 5, ycung[j] + 20);	//bonbon
		j = j + step;
	}
		
//an tiểu hạn
	context.font = '8pt Times New Roman';
	context.textAlign = "center";
 	var tieuhan;
	if (chinam == 3 || chinam == 7 || chinam == 11)
	{
		tieuhan = 3;
	}
	else if (chinam == 9 || chinam == 1 || chinam == 5)
	{
		tieuhan = 9;
	}
	else if (chinam == 6 || chinam == 10 || chinam == 2)
	{
		tieuhan = 6;
	}
	else tieuhan = 12;
	xpoint[1] += 5;
	xpoint[2] += 5;
	xpoint[3] += 5;
	xpoint[4] += 5;

	xpoint[7] -= 5;
	xpoint[8] -= 5;
	xpoint[9] -= 5;
	xpoint[10] -= 5;

	ypoint[4] += 15;
	ypoint[5] += 15;
	ypoint[6] += 15;

	ypoint[7] += 15;

	ypoint[10] -= 5;
	ypoint[11] -= 5;
	ypoint[12] -= 5;
	ypoint[1] -= 5;

	ypoint[2] += 5;
	ypoint[3] += 5;
	ypoint[8] += 5;
	ypoint[9] += 5;

	var n = chinam;
	var k = tieuhan;
	var step;
	if (amduong == "Dương Nam" || amduong == "Âm Nam")
		step = 1;
	else step = -1;

	for (i = 1; i<= 12; i++)
	{
		k = fix12(k);
		n = fix12(n);
		j = fix12(n - 2);
		var mausac = thuy;
		
		if (k == 1 || k == 2 || k == 3 || k == 4)
			context.textAlign = "left";
		else if (k == 7 || k == 8 || k == 9 || k == 10)
			context.textAlign = "right";
		else 
			context.textAlign = "center";
		
		if (chi[n]==chi[chixem])
			{
				chi[n] = chi[n]+"*";			
			}
				
		printw(chi[n], mausac, xpoint[k], ypoint[k]);
		k ++;
		n = n + step;
	}

// an TUAN, TRIET
function antuantriet(tcannam, tchinam)
{
	var tuankhong;
	var trietkhong;
	j = tchinam + 1;
	var start = tcannam;
	if (tcannam == 1)
		start = 2;
	for (i = start; i != 1; i = fix10(i+1))
	{
		j++;
		j = fix12(j);
	}
	tuankhong = fix12(j - 2);

	if (tuankhong == 5 || tuankhong == 6)
		tuankhong = 5;
	else if (tuankhong == 11 || tuankhong == 12)
		tuankhong = 11;
	else if (tuankhong == 7 || tuankhong == 8)
		tuankhong = 7;
	else if (tuankhong == 9 || tuankhong == 10)
		tuankhong = 9;
	else if (tuankhong == 1 || tuankhong == 2)
		tuankhong = 2;
	else if (tuankhong == 3 || tuankhong == 4)
		tuankhong = 4;
	else
		tuankhong = 4;
		
	if (tuankhong == 5)
	{
		x = xcung[tuankhong] + w - 25;
		y = ycung[tuankhong] + h - 7;
	}
	else if (tuankhong == 11)
	{
		x = xcung[tuankhong] - 25;
		y = ycung[tuankhong] - 7;
	}
	else if (tuankhong == 7)
	{ 
		x = xcung[tuankhong] + 5; 
		y = ycung[tuankhong] + h - 7; 
	}
	else if (tuankhong == 9) 
	{
		x = xcung[tuankhong] + 5; 
		y = ycung[tuankhong] + h - 7; 
	}
	else if (tuankhong == 2) 
	{ 
		x = xcung[tuankhong] + w - 50 - 5; 
		y = ycung[tuankhong] + h - 7; 
	}
	else if (tuankhong == 4) 
	{ 
		x = xcung[tuankhong] + w - 50 - 5; 
		y = ycung[tuankhong] + h - 7; 
	} 

	
	if (tcannam == 1 || tcannam == 6) trietkhong = 7;
	else if (tcannam == 2 || tcannam == 7) trietkhong = 5;
	else if (tcannam == 3 || tcannam == 8) trietkhong = 4;
	else if (tcannam == 4 || tcannam == 9) trietkhong = 2;
	else if (tcannam == 5 || tcannam == 10) trietkhong = 11;

		var x,y;
		if (tuankhong != trietkhong)
		{
			context.fillStyle = 'black';
			context.fillRect(x, y, 50, 14);
			context.font = "bold 8pt Times New Roman";
			context.fillStyle = 'yellow';
			context.textAlign = 'center';
			context.fillText("TUẦN", x + 25, y + 10);

			if (trietkhong == 7)
			{
				x = xcung[trietkhong] + 5;
				y = ycung[trietkhong] + h - 7;
			}
			else if (trietkhong == 2 || trietkhong == 4)
			{
				x = xcung[trietkhong] + w - 50 - 5;
				y = ycung[trietkhong] + h - 7;
			}
			else if (trietkhong == 5)
			{
				x = xcung[trietkhong] + w - 25;
				y = ycung[trietkhong] + h - 7;
			}
			else if (trietkhong == 11)
			{
				x = xcung[trietkhong] - 25;
				y = ycung[trietkhong] - 7;
			}
			
			context.fillStyle = 'black';
			context.fillRect(x, y, 50, 14);
			context.font = "bold 8pt Times New Roman";
			context.fillStyle = 'yellow';
			context.textAlign = 'center';
			context.fillText("TRIỆT", x + 25, y + 10);
		}
		else
		{
			if (trietkhong == 7)
			{
				x = xcung[trietkhong] + 5;
				y = ycung[trietkhong] + h - 7;
			}
			else if (trietkhong == 2 || trietkhong == 4)
			{
				x = xcung[trietkhong] + w - 70 - 5;
				y = ycung[trietkhong] + h - 7;
			}
			else if (trietkhong == 5)
			{
				x = xcung[trietkhong] + w - 35;
				y = ycung[trietkhong] + h - 5;
			}
			else if (trietkhong == 11)
			{
				x = xcung[trietkhong] - 35;
				y = ycung[trietkhong] - 7;
			}
			
			context.fillStyle = 'black';
			context.fillRect(x, y, 70, 14);
			context.font = "bold 8pt Times New Roman";
			context.fillStyle = 'yellow';
			context.textAlign = 'center';
			context.fillText("TUẦN-TRIỆT", x + 35, y + 10);
		}
		
	if (saoluu==1)
	{
		var tuankhongluu;
		var trietkhongluu;
		j = chixem+1;
		var start = canxem;
		if (canxem == 1)
			start = 2;
		for (i = start; i != 1; i = fix10(i+1))
		{
			j++;
			j = fix12(j);
		}
		tuankhongluu = fix12(j - 2);
		
		if (tuankhongluu == 5 || tuankhongluu == 6)
		{
			tuankhongluu = 5;
			x = xcung[tuankhongluu] + w - 25;
			y = ycung[tuankhongluu] - 7;
		}
		else if (tuankhongluu == 11 || tuankhongluu == 12)
		{
			tuankhongluu = 11;
			x = xcung[tuankhongluu] - 25;
			y = ycung[tuankhongluu] - 7 - 2 - 14;
		}
		else if (tuankhongluu == 7 || tuankhongluu == 8)
		{
			tuankhongluu = 7;
			x = xcung[tuankhongluu] + w - 50 - 5;
			y = ycung[tuankhongluu] + h - 7;
		}
		else if (tuankhongluu == 9 || tuankhongluu == 10)
		{
			tuankhongluu = 9;
			x = xcung[tuankhongluu] + w - 50 - 5;
			y = ycung[tuankhongluu] + h - 7;
		}
		else if (tuankhongluu == 1|| tuankhongluu == 2)
		{
			tuankhongluu = 2;
			x = xcung[tuankhongluu] + 5;
			y = ycung[tuankhongluu] + h - 7;
		}
		else if (tuankhongluu == 3 || tuankhongluu == 4)
		{
			tuankhongluu = 4;
			x = xcung[tuankhongluu] + 5;
			y = ycung[tuankhongluu] + h - 7;
		}
		
		if (canxem == 1 || canxem == 6) trietkhongluu = 7;
		else if (canxem == 2 || canxem == 7) trietkhongluu = 5;
		else if (canxem == 3 || canxem == 8) trietkhongluu = 4;
		else if (canxem == 4 || canxem == 9) trietkhongluu = 2;
		else if (canxem == 5 || canxem == 10) trietkhongluu = 11;

		var x,y;
		if (tuankhongluu != trietkhongluu)
		{
			context.fillStyle = 'brown';
			context.fillRect(x, y, 50, 14);
			context.font = "bold 8pt Times New Roman";
			context.fillStyle = 'white';
			context.textAlign = 'center';
			context.fillText("TUẦN", x + 25, y + 10);

			if (trietkhongluu == 2 || trietkhongluu == 4)
			{
				x = xcung[trietkhongluu] + 5;
				y = ycung[trietkhongluu] + h - 7;
			}
			else if (trietkhongluu == 7)
			{
				x = xcung[trietkhongluu] + w - 50 - 5;
				y = ycung[trietkhongluu] + h - 7;
			}
			else if (trietkhongluu == 5)
			{
				x = xcung[trietkhongluu] + w - 25;
				y = ycung[trietkhongluu] + h + 7 + 2;
			}
			else if (trietkhongluu == 11)
			{
				x = xcung[trietkhongluu] - 25;
				y = ycung[trietkhongluu] - 7 - 2 - 14;
			}

			context.fillStyle = 'brown';
			context.fillRect(x, y, 50, 14);
			context.font = "bold 8pt Times New Roman";
			context.fillStyle = 'white';
			context.textAlign = 'center';
			context.fillText("TRIỆT", x + 25, y + 10);
		}
		else
		{
			if (trietkhongluu == 7)
			{
				x = xcung[trietkhongluu] + 5;
				y = ycung[trietkhongluu] + h - 7;
			}
			else if (trietkhongluu == 2 || trietkhongluu == 4)
			{
				x = xcung[trietkhongluu] + 5;
				y = ycung[trietkhongluu] + h - 7;
			}
			else if (trietkhongluu == 5)
			{
				x = xcung[trietkhongluu] + w - 35;
				y = ycung[trietkhongluu] + h + 7 + 2 ;
			}
			else if (trietkhongluu == 11)
			{
				x = xcung[trietkhongluu] - 35;
				y = ycung[trietkhongluu] - 7 - 2 - 14;
			}

			context.fillStyle = 'brown';
			context.fillRect(x, y, 70, 14);
			context.font = "bold 8pt Times New Roman";
			context.fillStyle = 'white';
			context.textAlign = 'center';
			context.fillText("TUẦN-TRIỆT", x + 35, y + 10);
		}
	}
}

//an Cung
function anCungName(tcungmenh, tcungthan)
{
	var cungname = new Array();
	cungname[1] = "MỆNH";
	cungname[2] = "PHỤ";
	cungname[3] = "PHÚC";
	cungname[4] = "ĐIỀN";
	cungname[5] = "QUAN";
	cungname[6] = "NÔ";
	cungname[7] = "DI";
	cungname[8] = "ÁCH";
	cungname[9] = "TÀI";
	cungname[10] = "TỬ";
	cungname[11] = "PHU/THÊ";
	cungname[12] = "BÀO";
	  	  
	j = tcungmenh;
	context.font = 'bold 9pt Times New Roman';
	for (i=1; i<=12; i++)
	{
		var temp = fix12(j);
		var texttemp = "";
		if (temp == tcungthan)
			texttemp = "-THÂN";
		printw(cungname[i] + texttemp, 'black', xcung[temp] + w/2, ycung[temp] + 20);
		j++;
	}
}

	antuantriet(cannam, chinam);
	anCungName(cungmenh, cungthan);

//an Chính tinh
	var line = new Array();
	var row = new Array();
	for (i=1;i<=12;i++)
	{
		line[i] = 1;
		row[i] = 5;
	}

	var tuvi;
	var X = cuc - ngay % cuc;
	if (ngay%cuc == 0) X = 0;
	var Y = (ngay + X)/cuc;
	var z;
	if (X % 2 == 0) z = Y + X;
	if (X % 2 != 0) z = Y - X;

	for (i=1; i<=12; i++)
	{
		line[i] += 1;
	}

	tuvi = fix12(z);
	var chinhtinh = new Array();
	chinhtinh[1] = "TỬ VI";
	chinhtinh[2] = "LIÊM TRINH";
	chinhtinh[3] = "THIÊN ĐỒNG";
	chinhtinh[4] = "VŨ KHÚC";
	chinhtinh[5] = "THÁI DƯƠNG";
	chinhtinh[6] = "THIÊN CƠ";
	chinhtinh[7] = "THIÊN PHỦ";
	chinhtinh[8] = "THÁI ÂM";
	chinhtinh[9] = "THAM LANG";
	chinhtinh[10] = "CỰ MÔN";
	chinhtinh[11] = "THIÊN TƯỚNG";
	chinhtinh[12] = "THIÊN LƯƠNG";
	chinhtinh[13] = "THẤT SÁT";
	chinhtinh[14] = "PHÁ QUÂN";

	var ict = new Array();
	ict[1] = tuvi;
	ict[7] = 14 - tuvi;
	
	if (tuvi == 1) 
		ict[7] = 1;
	
	var thienphu = ict[7];

	ict[2] = fix12(tuvi + 4);
	ict[3] = fix12(tuvi + 7);
	ict[4] = fix12(tuvi + 8);
	ict[5] = fix12(tuvi + 9);
	ict[6] = fix12(tuvi + 11);

	ict[8] = fix12(thienphu + 1);
	ict[9] = fix12(thienphu + 2);
	ict[10] = fix12(thienphu + 3);
	ict[11] = fix12(thienphu + 4);
	ict[12] = fix12(thienphu + 5);
	ict[13] = fix12(thienphu + 6);
	ict[14] = fix12(thienphu + 10);

	var numct = new Array();
	for (i=1; i<= 12; i++)
	{
		numct[i] = 0;
	}
	for (i=1; i<=14; i++)
	{
		numct[ict[i]] += 1;
	}

	context.font = 'bold 9pt Times New Roman';
	var mau;
	
	for (i=1; i<=14;i++)
	{
		mau = hoa;
		if (i>=7)
		{
			mau = 'blue';
		}
				
		var metrics = context.measureText(chinhtinh[i]);
		var fh = metrics.fontBoundingBoxAscent + metrics.fontBoundingBoxDescent;
		if (numct[ict[i]] == 1)
		{
			context.textAlign = 'center';
			printw(chinhtinh[i], mau, xcung[ict[i]] + w/2, ycung[ict[i]] + line[ict[i]]*fh + 8);
		}
		else if (numct[ict[i]] == 2)
		{
			if (row[ict[i]] > w/2)
			{
				context.textAlign = 'right';
			}
			else context.textAlign = 'left';
			printw(chinhtinh[i], mau, xcung[ict[i]] + row[ict[i]], ycung[ict[i]] + line[ict[i]]*fh + 8);
			row[ict[i]] += w - 10;
		}
	}

function ansao(start, step, flag)
{
	var temp = 0;
	var result;
	//0 back
	if (flag == 0)
		temp = temp - step + 1;
	else
	//1 forward
		temp = temp + step - 1;
	result = fix12(temp + start);
	return result;
}

	var vanxuong = ansao(9,gio,0);
	var vankhuc = ansao(3,gio,1);
	var taphu = ansao(3, thang, 1);
	var huubat = ansao(9,thang, 0);
	var thaitue = fix12(chinam - 2);
	
	if (saoluu == 1)
		{
		var vanxuongluu = ansao(9,gio,0);
		var vankhucluu = ansao(3,gio,1);
		var taphuluu = ansao(3, thang, 1);
		var huubatluu = ansao(9,thang, 0);
		var thaitueluu = fix12(chixem - 2);
		}
		
	var locton;
	if (cannam == 1) locton= 1;
	else if (cannam == 2) locton= 2;
	else if (cannam == 3) locton= 4;
	else if (cannam == 4) locton= 5;
	else if (cannam == 5) locton= 4;
	else if (cannam == 6) locton= 5;
	else if (cannam == 7) locton= 7;
	else if (cannam == 8) locton= 8;
	else if (cannam == 9) locton= 10;
	else if (cannam == 10) locton= 11;

	if (saoluu == 1)
		{
		var loctonluu;
		if (canxem == 1) loctonluu= 1;
		else if (canxem == 2) loctonluu= 2;
		else if (canxem == 3) loctonluu= 4;
		else if (canxem == 4) loctonluu= 5;
		else if (canxem == 5) loctonluu= 4;
		else if (canxem == 6) loctonluu= 5;
		else if (canxem == 7) loctonluu= 7;
		else if (canxem == 8) loctonluu= 8;
		else if (canxem == 9) loctonluu= 10;
		else if (canxem == 10) loctonluu= 11;
		}
		
	var kinhduong = fix12(locton + 1);
	var dala = fix12(locton - 1);
	if (saoluu == 1)
	{
		var kinhduongluu = fix12(loctonluu + 1);
		var dalaluu = fix12(loctonluu - 1);
	}
		
	var thienkhoi;
	var thienviet;

	if (cannam == 1)
	{
		thienkhoi = 12;
		thienviet = 6;
	}
	else if (cannam == 2)
	{
		thienkhoi = 11;
		thienviet = 7;
	}
	else if (cannam == 3)
	{
		thienkhoi = 10;
		thienviet = 8;
	}
	else if (cannam == 4)
	{
		thienkhoi = 8;
		thienviet = 10;
	}
	else if (cannam == 5 || cannam == 7)
	{
		thienkhoi = 6;
		thienviet = 12;
	}
	else if (cannam == 6)
	{
		thienkhoi = 7;
		thienviet = 11;
	}
	else if (cannam == 8)
	{
		thienkhoi = 5;
		thienviet = 1;
	}
	else if (cannam == 9)
	{
		thienkhoi = 4;
		thienviet = 2;
	}
	else if (cannam == 10)
 	{
		thienkhoi = 2;
		thienviet = 4;
	}


	var thienkhoiluu;
	var thienvietluu;
	if (saoluu == 1)
	{
		if (canxem == 1)
		{
			thienkhoiluu = 12;
			thienvietluu = 6;
		}
		else if (canxem == 2)
		{
			thienkhoiluu = 11;
			thienvietluu = 7;
		}
		else if (canxem == 3)
		{
			thienkhoiluu = 10;
			thienvietluu = 8;
		}
		else if (canxem == 4)
		{
			thienkhoiluu = 8;
			thienvietluu = 10;
		}
		else if (canxem == 5 || canxem == 7)
		{
			thienkhoiluu = 6;
			thienvietluu = 12;
		}
		else if (canxem == 6)
		{
			thienkhoiluu = 7;
			thienvietluu = 11;
		}
		else if (canxem == 8)
		{
			thienkhoiluu = 5;
			thienvietluu = 1;
		}
		else if (canxem == 9)
		{
			thienkhoiluu = 4;
			thienvietluu = 2;
		}
		else if (canxem == 10)
		{
			thienkhoiluu = 2;
			thienvietluu = 4;
		}
	}

	var tuongtinh;
	if (chinam == 3 || chinam == 7 || chinam == 11)
	{
		tuongtinh = 5;
	}
	else if (chinam == 4 || chinam == 8 || chinam == 12)
	{
		tuongtinh = 2;
	}
	else if (chinam == 5 || chinam == 9 || chinam == 1)
	{
		tuongtinh = 11;
	}
	else if (chinam == 6 || chinam == 10 || chinam == 2)
	{
		tuongtinh = 8;
	}

	var tuongtinhluu;
	if (saoluu == 1)
	{
		if (chixem == 3 || chixem == 7 || chixem == 11)
		{
			tuongtinhluu = 5;
		}
		else if (chixem == 4 || chixem == 8 || chixem == 12)
		{
			tuongtinhluu = 2;
		}
		else if (chixem == 5 || chixem == 9 || chixem == 1)
		{
			tuongtinhluu = 11;
		}
		else if (chixem == 6 || chixem == 10 || chixem == 2)
		{
			tuongtinhluu = 8;
		}
	}
	
//an sao Chi
	var xleft = new Array;
	var xleft_adj = 8;
	xleft[1] = xleft_adj;
	xleft[2] = xleft_adj;
	xleft[3] = xleft_adj;
	xleft[4] = xleft_adj;
	xleft[5] = (w * 1) + xleft_adj;
	xleft[6] = (w * 2) + xleft_adj;
	xleft[7] = (w * 3) + xleft_adj;
	xleft[8] = xleft[7];
	xleft[9] = xleft[7];
	xleft[10] = xleft[7];
	xleft[11] = xleft[6];
	xleft[12] = xleft[5];
	
	var xright = new Array;
	var xright_adj = 8;
	xright[1] = (w * 1) - xright_adj;
	xright[2] = (w * 1) - xright_adj;
	xright[3] = (w * 1) - xright_adj;
	xright[4] = (w * 1) - xright_adj;
	xright[5] = (w * 2) - xright_adj;
	xright[6] = (w * 3) - xright_adj;
	xright[7] = (w * 4) - xright_adj;
	xright[8] = xright[7];
	xright[9] = xright[7];
	xright[10] = xright[7];
	xright[11] = xright[6];
	xright[12] = xright[5];

	var xcenter = new Array;
	xcenter[1] = (w / 2);
	xcenter[2] = (w / 2);
	xcenter[3] = (w / 2);
	xcenter[4] = (w / 2);
	xcenter[5] = (w * 1) + (w / 2);
	xcenter[6] = (w * 2) + (w / 2);
	xcenter[7] = (w * 3) + (w / 2);
	xcenter[8] = xcenter[7];
	xcenter[9] = xcenter[7];
	xcenter[10] = xcenter[7];
	xcenter[11] = xcenter[6];
	xcenter[12] = xcenter[5];
	
	var yleft = new Array;
	var adj = 8;
	yleft[1] = (h * 3) + (fh * 3) + adj;
	yleft[2] = (h * 2) + (fh * 3) + adj;
	yleft[3] = (h * 1) + (fh * 3) + adj;
	yleft[4] = fh * 3 + adj;
	yleft[5] = yleft[4];
	yleft[6] = yleft[4];
	yleft[7] = yleft[4];
	yleft[8] = yleft[3];
	yleft[9] = yleft[2];
	yleft[10] = yleft[1];
	yleft[11] = yleft[1];
	yleft[12] = yleft[1];
	
	var yright= new Array;
	yright[1] = yleft[1];
	yright[2] = yleft[2];
	yright[3] = yleft[3];
	yright[4] = yleft[4];
	yright[5] = yleft[5];
	yright[6] = yleft[6];
	yright[7] = yleft[7];
	yright[8] = yleft[8];
	yright[9] = yleft[9];
	yright[10] = yleft[10];
	yright[11] = yleft[11];
	yright[12] = yleft[12];

	var yleftbottom = new Array;
	var yleftbottom_adj = 10;
	yleftbottom[1] = (h * 4) - yleftbottom_adj;
	yleftbottom[2] = (h * 3) - yleftbottom_adj;
	yleftbottom[3] = (h * 2) - yleftbottom_adj;
	yleftbottom[4] = (h * 1) - yleftbottom_adj;
	yleftbottom[5] = yleftbottom[4];
	yleftbottom[6] = yleftbottom[4];
	yleftbottom[7] = yleftbottom[4];
	yleftbottom[8] = yleftbottom[3];
	yleftbottom[9] = yleftbottom[2];
	yleftbottom[10] = yleftbottom[1];
	yleftbottom[11] = yleftbottom[1];
	yleftbottom[12] = yleftbottom[1];
	
	var yrightbottom = new Array;
	yrightbottom[1] = yleftbottom[1];
	yrightbottom[2] = yleftbottom[2];
	yrightbottom[3] = yleftbottom[3];
	yrightbottom[4] = yleftbottom[4];
	yrightbottom[5] = yleftbottom[5];
	yrightbottom[6] = yleftbottom[6];
	yrightbottom[7] = yleftbottom[7];
	yrightbottom[8] = yleftbottom[8];
	yrightbottom[9] = yleftbottom[9];
	yrightbottom[10] = yleftbottom[10];
	yrightbottom[11] = yleftbottom[11];
	yrightbottom[12] = yleftbottom[12];
	
	var ycenterbottom = new Array;
	var ycenterbottom_adj = fh * 2;
	ycenterbottom[1] = (h * 4) - 8.5 - ycenterbottom_adj;
	ycenterbottom[2] = (h * 3) - 8.5 - ycenterbottom_adj;
	ycenterbottom[3] = (h * 2) - 8.5 - ycenterbottom_adj;
	ycenterbottom[4] = (h * 1) - 8.5 - ycenterbottom_adj;
	ycenterbottom[5] = ycenterbottom[4];
	ycenterbottom[6] = ycenterbottom[4];
	ycenterbottom[7] = ycenterbottom[4];
	ycenterbottom[8] = ycenterbottom[3];
	ycenterbottom[9] = ycenterbottom[2];
	ycenterbottom[10] = ycenterbottom[1];
	ycenterbottom[11] = ycenterbottom[1];
	ycenterbottom[12] = ycenterbottom[1];
	
	context.font = '9pt Times New Roman';
	context.fillStyle = 'black';
	
	// QUAN PHÙ
	context.textAlign = 'right';
	var quanphuH = fix12(thaitue + 4);
	context.fillText("Quan Phù", xright[quanphuH], yrightbottom[quanphuH]);
	yrightbottom[quanphuH] -= fh;
	
	// THIEN HU, TUE PHA
	var hupha = fix12(thaitue + 6);	// Tuế Phá
	context.fillText("Hư Phá", xright[hupha], yrightbottom[hupha]);
	yrightbottom[hupha] -= fh;
	
	// TANG MON
	var tangmon = fix12(thaitue + 2);
	context.fillText("Tang Môn", xright[tangmon], yrightbottom[tangmon]);
	yrightbottom[tangmon] -= fh;
	
	// THAI TUE
	var thaitue = thaitue;
	context.fillText("Thái Tuế", xright[thaitue], yrightbottom[thaitue]);
	yrightbottom[thaitue] -= fh;
	
	// BACH HO
	var bachho  = fix12(thaitue - 4);
	context.fillText("Bạch Hổ", xright[bachho], yrightbottom[bachho]);
	yrightbottom[bachho] -= fh;

	// DIEU KHACH
	var dieukhach = fix12(thaitue - 2);
	context.fillText("Điếu Khách", xright[dieukhach], yrightbottom[dieukhach]);
	yrightbottom[dieukhach] -= fh;
	
	// HONG LOAN
	var hongloan = ansao(2, chinam, 0);
	context.textAlign = 'left';
	context.fillText("Hồng Loan", xleft[hongloan], yleft[hongloan]);
	yleft[hongloan] += fh;
	
	// LONG TRI
	var longtri = ansao(3, chinam, 1);
	context.textAlign = 'left';
	context.fillText("Long Trì", xleft[longtri], yleft[longtri]);
	yleft[longtri] += fh;

	// DAO HOA
	var daohoa = fix12(tuongtinh - 3);
	context.textAlign = 'left';
	context.fillText("Đào Hoa", xleft[daohoa], yleft[daohoa]);
	yleft[daohoa] += fh;

	// THIEN HY
	var thienhy = fix12(hongloan + 6);
	context.textAlign = 'left';
	context.fillText("Thiên Hỷ", xleft[thienhy], yleft[thienhy]);
	yleft[thienhy] += fh;

	// PHUONG CAC
	var phuongcac = ansao(9, chinam, 0);	//Phượng Các
	if (phuongcac == longtri)
	{
		context.textAlign = 'right';
		context.fillText("Phượng Các", xright[phuongcac], yright[phuongcac]);
		yright[phuongcac] += fh;
	}
	else
	{
		context.textAlign = 'left';
		context.fillText("Phượng Các", xleft[phuongcac], yleft[phuongcac]);
		yleft[phuongcac] += fh;
	}
	
	// CO THAN, QUA TU
	var cothan, quatu;
	if (chinam == 3 || chinam == 4 || chinam == 5)
	{
		cothan = 4;
		quatu = 12;
	}
	else if (chinam == 6 || chinam == 7 || chinam == 8)
	{
		cothan = 7;
		quatu = 3;
	}
	else if (chinam == 9 || chinam == 10 || chinam == 11)
	{
		cothan = 10;
		quatu = 6;
	}
	else if (chinam == 12 || chinam == 1 || chinam == 2)
	{
		cothan = 1;
		quatu = 9;
	}
	context.textAlign = 'right';
	context.fillText("Cô Thần", xright[cothan], yright[cothan]);
	yright[cothan] += fh;
	
	context.fillText("Quả Tú", xright[quatu], yright[quatu]);
	yright[quatu] += fh;
	
	// HOA CAI
	context.textAlign = 'left';
	var hoacai = fix12(tuongtinh + 4);	
	context.fillText("Hoa Cái", xleft[hoacai], yleft[hoacai]);
	yleft[hoacai] += fh;
	
//an sao Tháng, Giờ
	// VAN XUONG
	context.textAlign = 'left';
	context.fillText("Văn Xương", xleft[vanxuong], yleft[vanxuong]);
	yleft[vanxuong] += fh;
	
	// VAN KHUC
	context.fillText("Văn Khúc", xleft[vankhuc], yleft[vankhuc]);
	yleft[vankhuc] += fh;
	
	// TA PHU
	context.fillText("Tả Phù", xleft[taphu], yleft[taphu]);
	yleft[taphu] += fh;
	
	// HUU BAT
	if (huubat == taphu)
		{
		context.textAlign = 'right';
		context.fillText("Hữu Bật", xright[huubat], yright[huubat]);
		yright[huubat] += fh;
		}
	else
		{
		context.textAlign = 'left';
		context.fillText("Hữu Bật", xleft[huubat], yleft[huubat]);
		yleft[huubat] += fh;
		}
	
	// AN QUANG
	context.textAlign = 'left';
	var anquang = fix12(vanxuong + ngay - 2);
	context.fillText("Ân Quang", xleft[anquang], yleft[anquang]);
	yleft[anquang] += fh;

	// THIEN QUY
	var thienquy = fix12(vankhuc - ngay + 2);
	if (thienquy == anquang)
	{
		context.textAlign = 'right';
		context.fillText("Thiên Quý", xright[thienquy], yright[thienquy]);
		yright[thienquy] += fh;
	}
	else
	{
		context.textAlign = 'left';
		context.fillText("Thiên Quý", xleft[thienquy], yleft[thienquy]);
		yleft[thienquy] += fh;
	}
	
	// TAM THAI
	context.textAlign = 'left';
	var tamthai = fix12(taphu + ngay - 1);
	context.fillText("Tam Thai", xleft[tamthai], yleft[tamthai]);
	yleft[tamthai] += fh;
		
	// BAT TOA
	var battoa = fix12(huubat - ngay + 1);
	if (battoa == tamthai)
	{
		context.textAlign = 'right';
		context.fillText("Bát Tọa", xright[battoa], yright[battoa]);
		yright[battoa] += fh;
	}
	else
	{
		context.textAlign = 'left';
		context.fillText("Bát Tọa", xleft[battoa], yleft[battoa]);
		yleft[battoa] += fh;
	}
	
	// THIEN KHOI
	context.textAlign = 'left';
	context.fillText("Thiên Khôi", xleft[thienkhoi], yleft[thienkhoi]);
	yleft[thienkhoi] += fh;
		
	// THIEN VIET
	context.textAlign = 'left';
	context.fillText("Thiên Việt", xleft[thienviet], yleft[thienviet]);
	yleft[thienviet] += fh;
	
	// THAI PHU
	var thaiphu = fix12(vankhuc + 2);
	context.textAlign = 'left';
	context.fillText("Thai Phụ", xleft[thaiphu], yleft[thaiphu]);
	yleft[thaiphu] += fh;
	
	// PHONG CAO
	var phongcao = fix12(vankhuc - 2);
	context.textAlign = 'left';
	context.fillText("Phong Cáo", xleft[phongcao], yleft[phongcao]);
	yleft[phongcao] += fh;
	
	
//an sao Can, Lộc Tồn, Kình Đà
	var nhom6 = new Array();
	nhom6[1] = "LỘC TỒN";
	nhom6[2] = "KÌNH DƯƠNG";
	nhom6[3] = "ĐÀ LA";
	nhom6[4] = "Bác Sỹ";
	nhom6[5] = "Lực Sĩ";
	nhom6[6] = "Thanh Long";
	nhom6[7] = "Tiểu Hao";
	nhom6[8] = "Tướng Quân";
	nhom6[9] = "Tấu Thư";
	nhom6[10] = "Phi Liêm";
	nhom6[11] = "Hỉ Thần";
	nhom6[12] = "Bệnh Phù";
	nhom6[13] = "Đại Hao";
	nhom6[14] = "Phục Binh";
	nhom6[15] = "Quan Phủ";
	nhom6[16] = "Quốc Ấn";
	nhom6[17] = "Đường Phù";

	var in6 = new Array();
	in6[1] = locton;
	in6[2] = kinhduong;
	in6[3] = dala;
	in6[4] = locton;

	for (i=5; i<=15; i++)
	{
		if (amduong == "Dương Nam" || amduong == "Âm Nữ")
			in6[i] = fix12(in6[i-1] + 1);
		else
			in6[i] = fix12(in6[i-1] - 1);
	}

	// LOC TON
	context.textAlign = 'left';
	context.fillText("Lộc Tồn", xleft[locton], yleft[locton]);
	yleft[locton] += fh;
	
	// KINH DUONG
	context.textAlign = 'right';
	context.fillText("KÌNH DƯƠNG", xright[kinhduong], yright[kinhduong]);
	yright[kinhduong] += fh;

	// DA LA
	context.textAlign = 'right';
	context.fillText("ĐÀ LA", xright[dala], yright[dala]);
	yright[dala] += fh;
	
	// VONG BAC SY
	context.textAlign = 'left';
	for (i=4; i<=15; i++)
	{
		context.fillText(nhom6[i], xleft[in6[i]], yleftbottom[in6[i]]);
		yleftbottom[in6[i]] -= fh;
	}
	
	// QUOC AN
	var quocan = fix12(locton + 8);	//in6[16] = fix12(locton + 8);
	context.textAlign = 'left';
	context.fillText("Quốc Ấn", xleft[quocan], yleft[quocan]);
	yleft[quocan] += fh;
	
	// DUONG PHU
	var duongphu = fix12(locton - 7);	//in6[17] = fix12(locton - 7);
	context.textAlign = 'right';
	context.fillText("Đường Phù", xright[duongphu], yright[duongphu]);
	yright[duongphu] += fh;
	
//an tứ Hóa, Riêu, Y, KHÔNG KIẾP
	var nhom5 = new Array()
	nhom5[1] = "Thiên Riêu";
	nhom5[2] = "Thiên Y";
	nhom5[3] = "THIÊN KHÔNG";
	nhom5[4] = "ĐỊA KIẾP";
	nhom5[5] = "HÓA QUYỀN";
	nhom5[6] = "HÓA KHOA";
	nhom5[7] = "HÓA LỘC";
	nhom5[8] = "HÓA KỴ";
	nhom5[9] = "Thiên Hình";
	nhom5[10] = "Hỏa Tinh";
	nhom5[11] = "Linh Tinh";
	
	// THIEN HINH
	var thienhinh = ansao(8,thang,1);	//in5[9] = ansao(8,thang,1);
	context.textAlign = 'right';
	context.fillText("Thien Hình", xright[thienhinh], yright[thienhinh]);
	yright[thienhinh] += fh;
		
	// THIEN RIEU, THIEN Y
	var thienrieu = fix12(thienhinh + 4);	//in5[1] = fix12(in5[9] + 4);
	//var thieny = thienrieu;	//in5[2] = in5[1];
	context.textAlign = 'right';
	context.fillText("Thien Riêu/Y", xright[thienrieu], yright[thienrieu]);
	yright[thienrieu] += fh;
	
	// THIEN KHONG
	var thienkhong = ansao(10, gio, 0);	//in5[3] = ansao(10, gio, 0);
	context.textAlign = 'right';
	context.fillText("THIÊN KHÔNG", xright[thienkhong], yright[thienkhong]);
	yright[thienkhong] += fh;
	
	// DIA KIEP
	var diakiep = ansao(10, gio, 1);	//in5[4] = ansao(10, gio, 1);
	context.textAlign = 'right';
	context.fillText("ĐỊA KIẾP", xright[diakiep], yright[diakiep]);
	yright[diakiep] += fh;
	
	
	var hoaloc;
	var hoaquyen;
	var hoakhoa;
	var hoaky;

	if (cannam == 1)
	{
		hoaloc = ict[2];
		hoaquyen = ict[14];
		hoakhoa = ict[4];
		hoaky = ict[5];
	}
	else if (cannam == 2)
	{
		hoaloc = ict[6];
		hoaquyen = ict[12];
		hoakhoa = ict[1];
		hoaky = ict[8];
	}
	else if (cannam == 3)
	{
		hoaloc = ict[3];
		hoaquyen = ict[6];
		hoakhoa = vanxuong;
		hoaky = ict[2];
	}
	else if (cannam == 4)
	{
		hoaloc = ict[8];
		hoaquyen = ict[3];
		hoakhoa = ict[6];
		hoaky = ict[10];
	}
	else if (cannam == 5)
	{
		hoaloc = ict[9];
		hoaquyen = ict[8];
		hoakhoa = huubat;
		hoaky = ict[6];
	}
	else if (cannam == 6)
	{
		hoaloc = ict[4];
		hoaquyen = ict[9];
		hoakhoa = ict[12];
		hoaky = vankhuc;
	}
	else if (cannam == 7)
	{
		hoaloc = ict[5];
		hoaquyen = ict[4];
		hoakhoa = ict[8];
		hoaky = ict[3];
	}
	else if (cannam == 8)
	{
		hoaloc = ict[10];
		hoaquyen = ict[5];
		hoakhoa = vankhuc;
		hoaky = vanxuong;
	}
	else if (cannam == 9)
	{
		hoaloc = ict[12];
		hoaquyen = ict[1];
		hoakhoa = taphu;
		hoaky = ict[4];
	}
	else if (cannam == 10)
	{
		hoaloc = ict[14];
		hoaquyen = ict[10];
		hoakhoa = ict[8];
		hoaky = ict[9];
	}

	// HOA QUYEN
	context.textAlign = 'center';
	context.fillText("HÓA QUYỀN", xcenter[hoaquyen], ycenterbottom[hoaquyen]);
	ycenterbottom[hoaquyen] -= fh;
	
	// HOA KHOA
	context.textAlign = 'center';
	context.fillText("HÓA KHOA", xcenter[hoakhoa], ycenterbottom[hoakhoa]);
	ycenterbottom[hoakhoa] -= fh;
	
	// HOA LOC
	context.textAlign = 'center';
	context.fillText("HÓA LỘC", xcenter[hoaloc], ycenterbottom[hoaloc]);
	ycenterbottom[hoaloc] -= fh;
	
	// HOA KY
	context.textAlign = 'center';
	context.fillText("HÓA KỴ", xcenter[hoaky], ycenterbottom[hoaky]);
	ycenterbottom[hoaky] -= fh;
	
	// HOA TINH, LINH TINH
	var bd_hoa;
	var bd_linh;

	if (chinam == 3 || chinam == 7 || chinam == 11)
	{
		bd_hoa = 12;
		bd_linh = 2;
	}
	else if (chinam == 4 || chinam == 8 || chinam == 12)
	{
		bd_hoa = 8;
		bd_linh = 9;
	}
	else if (chinam == 5 || chinam == 9 || chinam == 1)
	{
		bd_hoa = 1;
		bd_linh = 9;
	}
	else if (chinam == 6 || chinam == 10 || chinam == 2)
	{
		bd_hoa = 2;
		bd_linh = 9;
	}
	
	var hoatinh, linhtinh;
	if (amduong == "Dương Nam" || amduong == "Âm Nữ")
	{
		hoatinh = ansao(bd_hoa, gio, 1);
		linhtinh = ansao(bd_linh, gio, 0);
	}
	else
	{
		hoatinh = ansao(bd_hoa, gio, 0);
		linhtinh = ansao(bd_linh, gio, 1);
	}
	context.textAlign = 'right';
	context.fillText("HỎA TINH", xright[hoatinh], yright[hoatinh]);
	yright[hoatinh] += fh;
	
	context.fillText("LINH TINH", xright[linhtinh], yright[linhtinh]);
	yright[linhtinh] += fh;
	
	
//an sao cố định

	// THIEN LA
	var thienla = 3;
	context.textAlign = 'right';
	context.fillText("Thiên La", xright[thienla], yright[thienla]);
	yright[thienla] += fh;

	// DIA VONG
	var diavong = 9;
	context.textAlign = 'right';
	context.fillText("Địa Võng", xright[diavong], yright[diavong]);
	yright[diavong] += fh;
	
	// THIEN THUONG
	var thienthuong = fix12(cungmenh + 5);
	context.textAlign = 'right';
	context.fillText("Thiên Thương", xright[thienthuong], yright[thienthuong]);
	yright[thienthuong] += fh;
	
	// THIEN SU
	var thiensu = fix12(cungmenh -5);
	context.textAlign = 'right';
	context.fillText("Thiên Sứ", xright[thiensu], yright[thiensu]);
	yright[thiensu] += fh;
	
	// THIEN KHOC
	var thienkhoc = ansao(5, chinam, 0);
	context.textAlign = 'right';
	context.fillText("Thiên Khốc", xright[thienkhoc], yright[thienkhoc]);
	yright[thienkhoc] += fh;
	
	// PHA TOAI
	var phatoai;
	if (chinam == 3 || chinam == 9 || chinam == 6 || chinam == 12)
	{
		phatoai = 8;
	}
	else if (chinam == 1 || chinam == 4 || chinam == 7 || chinam == 10)
	{
		phatoai = 4;
	}
	else if (chinam == 5 || chinam == 11 || chinam == 2 || chinam == 8)
	{
		phatoai = 12;
	}
	
	context.textAlign = 'right';
	context.fillText("Phá Toái", xright[phatoai], yright[phatoai]);
	yright[phatoai] += fh;
	
	// LUU HA
	var luuha;
	if (cannam == 1)
		luuha = 8;
	else if (cannam == 2)
		luuha = 9;
	else if (cannam == 3)
		luuha = 6;
	else if (cannam == 4)
		luuha = 7;
	else if (cannam == 5)
		luuha = 4;
	else if (cannam == 6)
		luuha = 5;
	else if (cannam == 7)
		luuha = 2;
	else if (cannam == 8)
		luuha = 3;
	else if (cannam == 9)
		luuha = 10;
	else if (cannam == 10)
		luuha = 1;
	
	context.textAlign = 'right';
	context.fillText("Lưu Hà", xright[luuha], yright[luuha]);
	yright[luuha] += fh;
	
	// KIEP SAT
	var kiepsat = fix12(tuongtinh + 5);
	context.textAlign = 'right';
	context.fillText("Kiếp Sát", xright[kiepsat], yright[kiepsat]);
	yright[kiepsat] += fh;
	
	// THIEN MA
	var thienma;
	if (chinam == 3 || chinam == 7 || chinam == 11)
	{
		thienma = 7;
	}
	else if (chinam == 9 || chinam == 1 || chinam == 5)
	{
		thienma = 1;
	}
	else if (chinam == 6 || chinam == 10 || chinam == 2)
	{
		thienma = 10;
	}
	else thienma = 4;
	
	context.textAlign = 'left';
	context.fillText("Thiên Mã", xleft[thienma], yleft[thienma]);
	yleft[thienma] += fh;


	if (saoluu == 1)
	{
		context.fillStyle = 'brown';
		context.textAlign = 'right';
	
		// THAI TUE LUU
		var thaitueluu = thaitueluu;
		context.fillText("Thái Tuế", xright[thaitueluu], yrightbottom[thaitueluu]);
		yrightbottom[thaitueluu] -= fh;
			
		// QUAN PHÙ LƯU
		var quanphuHluu = fix12(thaitueluu + 4);
		context.fillText("Quan Phù", xright[quanphuHluu], yrightbottom[quanphuHluu]);
		yrightbottom[quanphuHluu] -= fh;
				
		// BACH HO LUU
		var bachholuu  = fix12(thaitueluu - 4);
		context.fillText("Bạch Hổ", xright[bachholuu], yrightbottom[bachholuu]);
		yrightbottom[bachholuu] -= fh;
				
		// THIEN HU, TUE PHA LUU
		var huphaluu = fix12(thaitueluu + 6);	// Tuế Phá
		context.fillText("Hư Phá", xright[huphaluu], yrightbottom[huphaluu]);
		yrightbottom[huphaluu] -= fh;
	
		// TANG MON LUU
		var tangmonluu = fix12(thaitueluu + 2);
		context.fillText("Tang Môn", xright[tangmonluu], yrightbottom[tangmonluu]);
		yrightbottom[tangmonluu] -= fh;
		
		// DIEU KHACH LUU
		var dieukhachluu = fix12(thaitueluu - 2);
		context.fillText("Điếu Khách", xright[dieukhachluu], yrightbottom[dieukhachluu]);
		yrightbottom[dieukhachluu] -= fh;
	
		// HONG LOAN LUU
		var hongloanluu = ansao(2, chixem, 0);
		context.textAlign = 'left';
		context.fillText("Hồng Loan", xleft[hongloan], yleft[hongloan]);
		yleft[hongloan] += fh;
	
		// LONG TRI LUU
		var longtriluu = ansao(3, chixem, 1);
		context.textAlign = 'left';
		context.fillText("Long Trì", xleft[longtriluu], yleft[longtriluu]);
		yleft[longtriluu] += fh;

		// DAO HOA LUU
		var daohoaluu = fix12(tuongtinhluu - 3);
		context.textAlign = 'left';
		context.fillText("Đào Hoa", xleft[daohoaluu], yleft[daohoaluu]);
		yleft[daohoaluu] += fh;

		// THIEN HY LUU
		var thienhyluu = fix12(hongloanluu + 6);
		context.textAlign = 'left';
		context.fillText("Thiên Hỷ", xleft[thienhyluu], yleft[thienhyluu]);
		yleft[thienhyluu] += fh;

		// PHUONG CAC LUU
		var phuongcacluu = ansao(9, chixem, 0);	//Phượng Các
		if (phuongcacluu == longtriluu)
		{
			context.textAlign = 'right';
			context.fillText("Phượng Các", xright[phuongcacluu], yright[phuongcacluu]);
			yright[phuongcacluu] += fh;
		}
		else
		{
			context.textAlign = 'left';
			context.fillText("Phượng Các", xleft[phuongcacluu], yleft[phuongcacluu]);
			yleft[phuongcacluu] += fh;
		}
	
		// CO THAN, QUA TU LUU
		var cothanluu, quatuluu;
		if (chixem == 3 || chixem == 4 || chixem == 5)
		{
			cothanluu = 4;
			quatuluu = 12;
		}
		else if (chixem == 6 || chixem == 7 || chixem == 8)
		{
			cothanluu = 7;
			quatuluu = 3;
		}
		else if (chixem == 9 || chixem == 10 || chixem == 11)
		{
			cothanluu = 10;
			quatuluu = 6;
		}
		else if (chixem == 12 || chixem == 1 || chixem == 2)
		{
			cothanluu = 1;
			quatuluu = 9;
		}
		context.textAlign = 'right';
		context.fillText("Cô Thần", xright[cothanluu], yright[cothanluu]);
		yright[cothanluu] += fh;
	
		context.fillText("Quả Tú", xright[quatuluu], yright[quatuluu]);
		yright[quatuluu] += fh;
	
		// HOA CAI LUU
		context.textAlign = 'left';
		var hoacailuu = fix12(tuongtinhluu + 4);	
		context.fillText("Hoa Cái", xleft[hoacailuu], yleft[hoacailuu]);
		yleft[hoacailuu] += fh;
	
//an nhóm 4
	// tmdo - var nhom4luu = new Array();
	// tmdo - nhom4luu[1] = "Văn Xương";
	// tmdo - nhom4luu[2] = "Văn Khúc";
	// tmdo - nhom4luu[3] = "Tả Phù";
	// tmdo - nhom4luu[4] = "Hữu Bật";
	// tmdo - nhom4luu[5] = "Ân Quang";
	// tmdo - nhom4luu[6] = "Thiên Quý";
	// tmdo - nhom4luu[7] = "Tam Thai";
	// tmdo - nhom4luu[8] = "Bát Tọa";
	// tmdo - nhom4luu[9] = "Thiên Khôi";
	// tmdo - nhom4luu[10] = "Thiên Việt";
	// tmdo - nhom4luu[11] = "Thai Phụ";
	// tmdo - nhom4luu[12] = "Phong Cáo";
	
	// tmdo - var in4luu = new Array();
	// tmdo - in4luu[1] = vanxuongluu;
	// tmdo - in4luu[2] = vankhucluu;
	// tmdo - in4luu[3] = taphuluu;
	// tmdo - in4luu[4] = huubatluu;
	// tmdo - in4luu[5] = fix12(vanxuongluu + ngay - 2);	// Ân Quang
	// tmdo - in4luu[6] = fix12(vankhucluu - ngay + 2);		// Thiên Quý
	// tmdo - in4luu[7] = fix12(taphuluu + ngay - 1);	// Tam Thai
	// tmdo - in4luu[8] = fix12(huubatluu - ngay + 1);	// Bát Tọa
	// tmdo - in4luu[9] = thienkhoiluu;	
	// tmdo - in4luu[10] = thienvietluu;
	// tmdo - in4luu[11] = fix12(vankhucluu + 2);	// Thai Phụ 
	// tmdo - in4luu[12] = fix12(vankhucluu - 2);	// Phong Cáo

	// VAN XUONG
	//context.textAlign = 'left';
	//context.fillText("Văn Xương", xleft[vanxuongluu], yleft[vanxuongluu]);
	//yleft[vanxuongluu] += fh;
	
	// VAN KHUC
	//context.fillText("Văn Khúc", xleft[vankhucluu], yleft[vankhucluu]);
	//yleft[vankhucluu] += fh;
	
	// TA PHU
	//context.fillText("Tả Phù", xleft[taphuluu], yleft[taphuluu]);
	//yleft[taphuluu] += fh;
	
	// HUU BAT
	//if (huubat == taphu)
		//{
		//context.textAlign = 'right';
		//context.fillText("Hữu Bật", xright[huubat], yright[huubat]);
		//yright[huubat] += fh;
		//}
	//else
		//{
		//context.textAlign = 'left';
		//context.fillText("Hữu Bật", xleft[huubat], yleft[huubat]);
		//yleft[huubat] += fh;
		//}
	
	// AN QUANG
	//context.textAlign = 'left';
	//var anquang = fix12(vanxuong + ngay - 2);
	//context.fillText("Ân Quang", xleft[anquang], yleft[anquang]);
	//yleft[anquang] += fh;

	// THIEN QUY
	//var thienquy = fix12(vankhuc - ngay + 2);
	//if (thienquy == anquang)
	//{
		//context.textAlign = 'right';
		//context.fillText("Thiên Quý", xright[thienquy], yright[thienquy]);
		//yright[thienquy] += fh;
	//}
	//else
	//{
		//context.textAlign = 'left';
		//context.fillText("Thiên Quý", xleft[thienquy], yleft[thienquy]);
		//yleft[thienquy] += fh;
	//}
	
	// TAM THAI
	//context.textAlign = 'left';
	//var tamthai = fix12(taphu + ngay - 1);
	//context.fillText("Tam Thai", xleft[tamthai], yleft[tamthai]);
	//yleft[tamthai] += fh;
		
	// BAT TOA
	//var battoa = fix12(huubat - ngay + 1);
	//if (battoa == tamthai)
	//{
		//context.textAlign = 'right';
		//context.fillText("Bát Tọa", xright[battoa], yright[battoa]);
		//yright[battoa] += fh;
	//}
	//else
	//{
		//context.textAlign = 'left';
		//context.fillText("Bát Tọa", xleft[battoa], yleft[battoa]);
		//yleft[battoa] += fh;
	//}
	
	// THIEN KHOI
	context.textAlign = 'left';
	context.fillText("Thiên Khôi", xleft[thienkhoiluu], yleft[thienkhoiluu]);
	yleft[thienkhoiluu] += fh;
		
	// THIEN VIET
	context.textAlign = 'left';
	context.fillText("Thiên Việt", xleft[thienvietluu], yleft[thienvietluu]);
	yleft[thienvietluu] += fh;
	
	// THAI PHU
	//var thaiphu = fix12(vankhuc + 2);
	//context.textAlign = 'left';
	//context.fillText("Thai Phụ", xleft[thaiphu], yleft[thaiphu]);
	//yleft[thaiphu] += fh;
	
	// PHONG CAO
	//var phongcao = fix12(vankhuc - 2);
	//context.textAlign = 'left';
	//context.fillText("Phong Cáo", xleft[phongcao], yleft[phongcao]);
	//yleft[phongcao] += fh;
	
	
//an sao Can, Lộc Tồn, Kình Đà lưu
	var nhom6luu = new Array();
	nhom6luu[1] = "LỘC TỒN";
	nhom6luu[2] = "KÌNH DƯƠNG";
	nhom6luu[3] = "ĐÀ LA";
	nhom6luu[4] = "Bác Sỹ";
	nhom6luu[5] = "Lực Sĩ";
	nhom6luu[6] = "Thanh Long";
	nhom6luu[7] = "Tiểu Hao";
	nhom6luu[8] = "Tướng Quân";
	nhom6luu[9] = "Tấu Thư";
	nhom6luu[10] = "Phi Liêm";
	nhom6luu[11] = "Hỉ Thần";
	nhom6luu[12] = "Bệnh Phù";
	nhom6luu[13] = "Đại Hao";
	nhom6luu[14] = "Phục Binh";
	nhom6luu[15] = "Quan Phủ";
	nhom6luu[16] = "Quốc Ấn";
	nhom6luu[17] = "Đường Phù";

	var in6luu = new Array();
	in6luu[1] = loctonluu;
	in6luu[2] = kinhduongluu;
	in6luu[3] = dalaluu;
	in6luu[4] = loctonluu;

	for (i=5; i<=15; i++)
	{
		if (amduong == "Dương Nam" || amduong == "Âm Nữ")
			in6luu[i] = fix12(in6luu[i-1] + 1);
		else
			in6luu[i] = fix12(in6luu[i-1] - 1);
	}

	// LOC TON LUU
	context.textAlign = 'left';
	context.fillText("Lộc Tồn", xleft[loctonluu], yleft[loctonluu]);
	yleft[loctonluu] += fh;
	
	// KINH DUONG LUU
	context.textAlign = 'right';
	context.fillText("KÌNH DƯƠNG", xright[kinhduongluu], yright[kinhduongluu]);
	yright[kinhduongluu] += fh;

	// DA LA LUU
	context.textAlign = 'right';
	context.fillText("ĐÀ LA", xright[dalaluu], yright[dalaluu]);
	yright[dalaluu] += fh;
	
	// VONG BAC SY LUU
	context.textAlign = 'left';
	for (i=4; i<=15; i++)
	{
		context.fillText(nhom6luu[i], xleft[in6luu[i]], yleftbottom[in6luu[i]]);
		yleftbottom[nhom6luu[i]] -= fh;
	}
	
	// QUOC AN LUU
	var quocanluu = fix12(loctonluu + 8);	//in6[16] = fix12(locton + 8);
	context.textAlign = 'left';
	context.fillText("Quốc Ấn", xleft[quocanluu], yleft[quocanluu]);
	yleft[quocanluu] += fh;
	
	// DUONG PHU LUU
	var duongphuluu = fix12(loctonluu - 7);	//in6[17] = fix12(locton - 7);
	context.textAlign = 'right';
	context.fillText("Đường Phù", xright[duongphuluu], yright[duongphuluu]);
	yright[duongphuluu] += fh;
	
//an tứ Hóa lưu
	
	var hoalocluu;
	var hoaquyenluu;
	var hoakhoaluu;
	var hoakyluu;

	if (canxem == 1)
	{
		hoalocluu = ict[2];
		hoaquyenluu = ict[14];
		hoakhoaluu = ict[4];
		hoakyluu = ict[5];
	}
	else if (canxem == 2)
	{
		hoalocluu = ict[6];
		hoaquyenluu = ict[12];
		hoakhoaluu = ict[1];
		hoakyluu = ict[8];
	}
	else if (canxem == 3)
	{
		hoalocluu = ict[3];
		hoaquyenluu = ict[6];
		hoakhoaluu = vanxuong;
		hoakyluu = ict[2];
	}
	else if (canxem == 4)
	{
		hoalocluu = ict[8];
		hoaquyenluu = ict[3];
		hoakhoaluu = ict[6];
		hoakyluu = ict[10];
	}
	else if (canxem == 5)
	{
		hoalocluu = ict[9];
		hoaquyenluu = ict[8];
		hoakhoaluu = huubat;
		hoakyluu = ict[6];
	}
	else if (canxem == 6)
	{
		hoalocluu = ict[4];
		hoaquyenluu = ict[9];
		hoakhoaluu = ict[12];
		hoakyluu = vankhuc;
	}
	else if (canxem == 7)
	{
		hoalocluu = ict[5];
		hoaquyenluu = ict[4];
		hoakhoaluu = ict[8];
		hoakyluu = ict[3];
	}
	else if (canxem == 8)
	{
		hoalocluu = ict[10];
		hoaquyenluu = ict[5];
		hoakhoaluu = vankhuc;
		hoakyluu = vanxuong;
	}
	else if (canxem == 9)
	{
		hoalocluu = ict[12];
		hoaquyenluu = ict[1];
		hoakhoaluu = taphu;
		hoakyluu = ict[4];
	}
	else if (canxem == 10)
	{
		hoalocluu = ict[14];
		hoaquyenluu = ict[10];
		hoakhoaluu = ict[8];
		hoakyluu = ict[9];
	}

	// HOA QUYEN LUU
	context.textAlign = 'center';
	context.fillText("HÓA QUYỀN", xcenter[hoaquyenluu], ycenterbottom[hoaquyenluu]);
	ycenterbottom[hoaquyenluu] -= fh;
	
	// HOA KHOA
	context.textAlign = 'center';
	context.fillText("HÓA KHOA", xcenter[hoakhoaluu], ycenterbottom[hoakhoaluu]);
	ycenterbottom[hoakhoaluu] -= fh;
	
	// HOA LOC
	context.textAlign = 'center';
	context.fillText("HÓA LỘC", xcenter[hoalocluu], ycenterbottom[hoalocluu]);
	ycenterbottom[hoalocluu] -= fh;
	
	// HOA KY
	context.textAlign = 'center';
	context.fillText("HÓA KỴ", xcenter[hoakyluu], ycenterbottom[hoakyluu]);
	ycenterbottom[hoakyluu] -= fh;
	

	// THIEN KHOC LUU
	var thienkhocluu = ansao(5, chixem, 0);
	context.textAlign = 'right';
	context.fillText("Thiên Khốc", xright[thienkhocluu], yright[thienkhocluu]);
	yright[thienkhocluu] += fh;
	
	// PHA TOAI LUU
	var phatoailuu;
	if (chixem == 3 || chixem == 9 || chixem == 6 || chixem == 12)
	{
		phatoailuu = 8;
	}
	else if (chixem == 1 || chixem == 4 || chixem == 7 || chixem == 10)
	{
		phatoailuu = 4;
	}
	else if (chixem == 5 || chixem == 11 || chixem == 2 || chixem == 8)
	{
		phatoailuu = 12;
	}
	
	context.textAlign = 'right';
	context.fillText("Phá Toái", xright[phatoailuu], yright[phatoailuu]);
	yright[phatoailuu] += fh;
	
	// LUU HA
	var luuhaluu;
	if (canxem == 1)
		luuhaluu = 8;
	else if (canxem == 2)
		luuhaluu = 9;
	else if (canxem == 3)
		luuhaluu = 6;
	else if (canxem == 4)
		luuhaluu = 7;
	else if (canxem == 5)
		luuhaluu = 4;
	else if (canxem == 6)
		luuhaluu = 5;
	else if (canxem == 7)
		luuhaluu = 2;
	else if (canxem == 8)
		luuhaluu = 3;
	else if (canxem == 9)
		luuhaluu = 10;
	else if (canxem == 10)
		luuhaluu = 1;
	
	context.textAlign = 'right';
	context.fillText("Lưu Hà", xright[luuhaluu], yright[luuhaluu]);
	yright[luuhaluu] += fh;
	
	// KIEP SAT LUU
	var kiepsatluu = fix12(tuongtinhluu + 5);
	context.textAlign = 'right';
	context.fillText("Kiếp Sát", xright[kiepsatluu], yright[kiepsatluu]);
	yright[kiepsatluu] += fh;
	
	// THIEN MA
	var thienmaluu;
	if (chixem == 3 || chixem == 7 || chixem == 11)
		thienmaluu = 7;
	else if (chixem == 9 || chixem == 1 || chixem == 5)
		thienmaluu = 1;
	else if (chixem == 6 || chixem == 10 || chixem == 2)
		thienmaluu = 10;
	else 
		thienmaluu = 4;
	
	context.textAlign = 'left';
	context.fillText("Thiên Mã", xleft[thienmaluu], yleft[thienmaluu]);
	yleft[thienmaluu] += fh;
	}
}

function Anlaso()
{
	main();
	var canvas = document.getElementById('LasoCanvas');
	var image = document.getElementById('canvasImg');
	image.src = canvas.toDataURL("image/png");
	image.style.display = 'block';
}

document.querySelector("#mTUVIform").addEventListener("submit", function(e)
{
    e.preventDefault();
    Anlaso();
}
);


</script>
   	<p>
    	<img id="canvasImg" alt="Right click to save me!" style="display:none;">
    </p>
</body>
</html>
